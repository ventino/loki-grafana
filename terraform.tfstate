{
  "version": 4,
  "terraform_version": "1.1.5",
  "serial": 80,
  "lineage": "c26adfdb-74af-2ec9-4ba4-eed9e68e727f",
  "outputs": {
    "network_address": {
      "value": [
        [
          "192.168.122.100"
        ]
      ],
      "type": [
        "tuple",
        [
          [
            "list",
            "string"
          ]
        ]
      ]
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "template_file",
      "name": "cloud_init",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "afb10f81ff2f3ff6e380eacdb99f8b8d88af2380f8c199f2495dc0d3a36ff5d3",
            "rendered": "#cloud-config\n# vim: syntax=yaml\n#\n\ngroups:\n    - sysop: [root,sys]\n\n\nusers:\n    - default\n    # User explicitly omitted from sudo permission; also default behavior. \n    - name: sysop\n      gecos: system operator\n      primary_group: sysop\n      groups: users, admin, docker\n      sudo: ALL=(ALL) NOPASSWD:ALL\n      homedir: /home/sysop\n      inactive: false\n      lock_passwd: true\n      shell: /bin/bash\n      system: true\n      uid: 1000\n      ssh_authorized_keys:\n        - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq6cUeVqUAZ7ln2qFxLwpYcM8u1J20upM6VGmv4HxNTi9yl1sOfGr/9fodVVBFquk25bhiUzBAA41GuKVpXzroZU4QBp6roUqvJVavwtG6VNZB+F8SEa4puLJ4cf3gqgTiuyIeSx5S19weke0ktoj6o+b1L84Eoa9pBh1LuWdO4f0jbRy4deFpm8VIVRGjLG58NKVTrNvGKThZG+O3qPtoetlRS1Z3JXVVea0nFBdPZxj9F03YGeGKOC8YDL6XXbuO+lKXWEyUxt6kW6Hlb2XQwrkkABmIUHq4r8pnmZilfpuTB8B4Vtwj4ZX+5y6DoE9oLVXOLW/AP1As/DKC8ixZQ== mihai@i5737z.sysop-consulting.ro\n      ssh_import_id: \n        - gh:mihaics\n        \n\ntimezone: UTC\n\nssh_import_id: \n    - gh:mihaics\n    \n\nntp:\n  enabled: true\n  ntp_client: chrony  # Uses cloud-init default chrony configuration\n\n\napt:\n  sources:\n    hashicorp:\n      source: \"deb [arch=amd64] https://apt.releases.hashicorp.com groovy main\"\n      key: |\n          -----BEGIN PGP PUBLIC KEY BLOCK-----\n\n          mQINBF60TuYBEADLS1MP7XrMlRkn1Y54cb2UclUMH8HkIRfBrhk5Leo9kNZc/2QD\n          LmdQbi3UbZkz0uVkHqbFDgV5lAnukCnxgr9BqnL0GJpO78le7gCCbM5bR4rTJ6Ar\n          OOtIKf25smGTIpbSwNdj8BOLqiExGFj/9L5X9S5kfq3vtuYt+lmxKkIrEPjSYnFR\n          TQ2mTL8RM932GJod/5VJ2+6YvrCjtPu5/rW02H1U2ZHiTtX6ZGnIvv/sprKyFRqT\n          x4Ib+o9XwXof/LuxTMpVwIHSzCYanH5hPc7yRGKzIntBS+dDom+h9smx7FTgpHwt\n          QRFGLtVoHXqON6nXTLFDkEzxr+fXq/bgB1Kc1TuzvoK601ztQGhhDaEPloKqNWM8\n          Ho7JU1RpnoWr5jOFTYiPM9uyCtFNsJmD9mt4K8sQQN7T2inR5Us0o510FqePRFeX\n          wOJUMi1CbeYqVHfKQ5cWYujcK8pv3l1a6dSBmFfcdxtwIoA16JzCrgsCeumTDvKu\n          hOiTctb28srL/9WwlijUzZy6R2BGBbhP937f2NbMS/rpby7M1WizKeo2tkKVyK+w\n          SUWSw6EtFJi7kRSkH7rvy/ysU9I2ma88TyvyOgIz1NRRXYsW7+brgwXnuJraOLaB\n          5aiuhlngKpTPvP9CFib7AW2QOXustMZ7pOUREmxgS4kqxo74CuFws163TwARAQAB\n          tFFIYXNoaUNvcnAgU2VjdXJpdHkgKEhhc2hpQ29ycCBQYWNrYWdlIFNpZ25pbmcp\n          IDxzZWN1cml0eStwYWNrYWdpbmdAaGFzaGljb3JwLmNvbT6JAk4EEwEIADgWIQTo\n          oDLglNjrTqGJ0nDaQYyIoyGfewUCXrRO5gIbAwULCQgHAgYVCgkICwIEFgIDAQIe\n          AQIXgAAKCRDaQYyIoyGfe6/WD/9dTM/1OSgbvSPpPJOOcn5L1nOKRBJpztr4V0ky\n          GoCDakIQ/sykbcuHXP79FGLzrM8zQOsbvVp/Z2lsWBnxkT8KWM+8LZxYToRGdZhr\n          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\n          =emKC\n          -----END PGP PUBLIC KEY BLOCK-----\n\npackage_upgrade: true\npackages:\n  - bash-completion\n  - consul\n  - htop\n  - iptables-persistent\n  - jq \n  - mc\n  - qemu-guest-agent\n  - runc\n  - vault\n  - vim\n  - wget\n  - zip \n  - snapd\n\n\n\nruncmd: # commands to run\n  - export ip_addr=$(ip route get 8.8.8.8 | awk -F\"src \" 'NR==1{split($2,a,\" \");print a[1]}')\n  - echo net.ipv6.conf.all.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.default.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.lo.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - sysctl -p\n  - systemctl enable iscsid\n  - snap install microk8s --classic\n  - snap enable microk8s\n  - snap start microk8s \n  - snap install helm --classic\n  - usermod -a -G microk8s sysop\n  - echo alias \\\"kubectl=microk8s kubectl\\\" \u003e\u003e /home/sysop/.profile\n  - mkdir -p /home/sysop/.kube\n  - mkdir -p /root/.kube\n  - microk8s config \u003e /home/sysop/.kube/config\n  - chmod 600 /home/sysop/.kube/config\n  - microk8s config \u003e /root/.kube/config\n  - chmod 600 /root/.kube/config\n  - chown -R sysop:sysop /home/sysop/\n  - wait 120\n  - microk8s enable rbac dns ingress openebs\n  - microk8s kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.3.1/cert-manager.yaml\n  - helm repo add grafana https://grafana.github.io/helm-charts\n  - helm repo update\n  #- helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false\n  - helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false,loki.persistence.enabled=true,loki.persistence.storageClassName=openebs-hostpath,loki.persistence.size=5Gi\n\n\n\n\n\npower_state:\n  mode: reboot\n  delay: 300\n  condition: microk8s status\n\n\n",
            "template": "#cloud-config\n# vim: syntax=yaml\n#\n\ngroups:\n    - ${os_user}: [root,sys]\n\n\nusers:\n    - default\n    # User explicitly omitted from sudo permission; also default behavior. \n    - name: ${os_user}\n      gecos: system operator\n      primary_group: ${os_user}\n      groups: users, admin, docker\n      sudo: ALL=(ALL) NOPASSWD:ALL\n      homedir: /home/${os_user}\n      inactive: false\n      lock_passwd: true\n      shell: /bin/bash\n      system: true\n      uid: 1000\n      ssh_authorized_keys:\n        - ${root_ssh_key}\n      ssh_import_id: \n        - ${dev_ssh_id}\n        \n\ntimezone: UTC\n\nssh_import_id: \n    - ${dev_ssh_id}\n    \n\nntp:\n  enabled: true\n  ntp_client: chrony  # Uses cloud-init default chrony configuration\n\n\napt:\n  sources:\n    hashicorp:\n      source: \"deb [arch=amd64] https://apt.releases.hashicorp.com groovy main\"\n      key: |\n          -----BEGIN PGP PUBLIC KEY BLOCK-----\n\n          mQINBF60TuYBEADLS1MP7XrMlRkn1Y54cb2UclUMH8HkIRfBrhk5Leo9kNZc/2QD\n          LmdQbi3UbZkz0uVkHqbFDgV5lAnukCnxgr9BqnL0GJpO78le7gCCbM5bR4rTJ6Ar\n          OOtIKf25smGTIpbSwNdj8BOLqiExGFj/9L5X9S5kfq3vtuYt+lmxKkIrEPjSYnFR\n          TQ2mTL8RM932GJod/5VJ2+6YvrCjtPu5/rW02H1U2ZHiTtX6ZGnIvv/sprKyFRqT\n          x4Ib+o9XwXof/LuxTMpVwIHSzCYanH5hPc7yRGKzIntBS+dDom+h9smx7FTgpHwt\n          QRFGLtVoHXqON6nXTLFDkEzxr+fXq/bgB1Kc1TuzvoK601ztQGhhDaEPloKqNWM8\n          Ho7JU1RpnoWr5jOFTYiPM9uyCtFNsJmD9mt4K8sQQN7T2inR5Us0o510FqePRFeX\n          wOJUMi1CbeYqVHfKQ5cWYujcK8pv3l1a6dSBmFfcdxtwIoA16JzCrgsCeumTDvKu\n          hOiTctb28srL/9WwlijUzZy6R2BGBbhP937f2NbMS/rpby7M1WizKeo2tkKVyK+w\n          SUWSw6EtFJi7kRSkH7rvy/ysU9I2ma88TyvyOgIz1NRRXYsW7+brgwXnuJraOLaB\n          5aiuhlngKpTPvP9CFib7AW2QOXustMZ7pOUREmxgS4kqxo74CuFws163TwARAQAB\n          tFFIYXNoaUNvcnAgU2VjdXJpdHkgKEhhc2hpQ29ycCBQYWNrYWdlIFNpZ25pbmcp\n          IDxzZWN1cml0eStwYWNrYWdpbmdAaGFzaGljb3JwLmNvbT6JAk4EEwEIADgWIQTo\n          oDLglNjrTqGJ0nDaQYyIoyGfewUCXrRO5gIbAwULCQgHAgYVCgkICwIEFgIDAQIe\n          AQIXgAAKCRDaQYyIoyGfe6/WD/9dTM/1OSgbvSPpPJOOcn5L1nOKRBJpztr4V0ky\n          GoCDakIQ/sykbcuHXP79FGLzrM8zQOsbvVp/Z2lsWBnxkT8KWM+8LZxYToRGdZhr\n          huFPHV9df0vAsZGisu4ejHDneHOTO3KqVotkky34jUSjBL7Q8uwXHY9r+5hb452N\n          vafN1w0Y1QVhb6JjjwWHR8Rf9qkSIEi6m9o8a1M54yQC2y/Zrs6+4F3zZ4uYfTvz\n          MyFfj0P5VmAoaowLSRdb2/JTObu0+zpKN+PjZA8BcnOf/pvqmEz83FIfo6zJLScx\n          TVaAwj5Iz/jS04x7EvBuIP3vpgv1R6r+t0qU/7hpu7Oc0dsxhL+C8BpVY26/2hvX\n          ozN5eG0ysSwexqwls+bnRgd6KdoHlWFNfbW8RCPKyb/s+tmFqGAY/QmxMkukgnXQ\n          WvBoa0Gdv2AFVLYup9tEO1zF4zBPh5oQwAXDNudLTHJ4KmyEwWsOQJUjNB4y4a7j\n          iGgK77T4KKXpo7pVDP8Ur+tmNH/d+/YFjxrfJvWt4ypE5dZmFO/FrUMvIGglOLDt\n          A+SiQe73IpEebB8PiqNlqJ2NU7artuRxYQVColt+/1puIHwV+h0SnMoUEvYqAtxP\n          J/N3JaiytWlesPPFWvhU/JGUAld5coEU2gbYtlenV/YmdjilIBu50sMSPGF5/6gv\n          BAA/DbkCDQRetE7mARAA0OH1pn0vdEfSm1kdqIDP3BXBD0BRHNNgGpyXXRRJFaip\n          bmpu7jSv3FsvN/NmG3BcLXXLFvwY/eIOr6fxRye+a5FSQEtvBnI1GHNmD5GAVT/H\n          KiwrT5e3ReR/FQS7hCXWU4OA2bKmSEdkJ952NhyYeyAKbkOBgbnlEhtWOAdMI7ws\n          peHAlHDqfGVOKXDh+FddCUQj/yZ2rblSzFdcC9gtcJSyHWgOQdVAEesEZ16hcZoj\n          +6O+6BXOQWOo7EPD7lA9a1qesBkSRcxQn48IVVZ2Qx2P2FtCfF+SFX+HQdqJGl15\n          qxE5CXTuJCMmCVnWhvcLW405uF/HmMFXdqGobEDiQsFFQrfpPVOi4T90VkW8P81s\n          uPoAlWht1CppNnmhWlvPQsPK/oSMBBOvOEH1EnWJate8yIkveNbqzrE7Xt3sjF6k\n          yqXaF+qW8OcDvSH/fgvVd21G10Cm77Z2WaKWvfi221oWj+WrgT8cCYv0AVmaLRMe\n          dajuYlPRQ8KaZaESza2eXggOMP5LQs/mQgfHfwSRekSbKg/L6ctp+xrZ0DPj4iIl\n          8+H4DxTILopAFWXA1a+uMVp8mV77gA9PyV3nIkrwgaZQ8MdhoKwvN/+SbvhpdzyF\n          UekzMP/HOaC6JgAomluwnFCdMDFa3FMCF3QUcIyY556QdoFD7g6033xqV6vL+d8A\n          EQEAAYkCNgQYAQgAIBYhBOigMuCU2OtOoYnScNpBjIijIZ97BQJetE7mAhsMAAoJ\n          ENpBjIijIZ97lecP+wTgSqhCz3TlUshR8lVrzECueIg3jh3+lY56am9X4MoZ2DAW\n          IXKjWKVWO55WPYD15A7+TbDyb4zh55m81LxSpV0CSRN4aPuixosWP4d0l+363D2F\n          oudz+QyvoK5J2sKFPMfhdTgGsEYVO/Zbhus5oNi0kjUTD9U7jHWPS3ilvk/g2F+k\n          T68lL9+oooleeT+kcBvbKt487JUOwMrkmHqNZdh8qmvMASAuqBcEcqjz96kVEMJY\n          bhn2skexKfIncoo/btixzJUbnplpDfibFxUHhvWWdwIv4kl3YnrCKKGSDoJcG1mV\n          sQegK4jWVGrqY8MnCI48iotP18ZxyqOycsZvs2jNmFlKwD9s1mrlr97HZ1MYbLWr\n          Hq06owH0AzVRM7tzMK7EuHkFLcoa8qh3oijn8O0B7xNOKpTZ2DjajQ/1w8nqmMi5\n          Z3Wie6ivKng/7p6c6HDrKjoQYc0/fuh1YnL60JG2Arn1OwdBsLDlzPL+Ro5iNwoJ\n          hZ+stxoZT48iAIWonBsLU11Y+MSwWdN1Eh411HTTunrEs6SafMEhnPi7vvUIZhny\n          Es0qOM/IUR1I0VtsurSn8aA6Y2Bp73+HuqFLx13/tPKBIUo6D7n/ywUlDCo7wtCw\n          aSgXPw6uF+0CyLOQ0haf2j6w1OB8ayEGSkTPER5rImCJf3MGw8IECGrErAd+\n          =emKC\n          -----END PGP PUBLIC KEY BLOCK-----\n\npackage_upgrade: true\npackages:\n  - bash-completion\n  - consul\n  - htop\n  - iptables-persistent\n  - jq \n  - mc\n  - qemu-guest-agent\n  - runc\n  - vault\n  - vim\n  - wget\n  - zip \n  - snapd\n\n\n\nruncmd: # commands to run\n  - export ip_addr=$(ip route get 8.8.8.8 | awk -F\"src \" 'NR==1{split($2,a,\" \");print a[1]}')\n  - echo net.ipv6.conf.all.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.default.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.lo.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - sysctl -p\n  - systemctl enable iscsid\n  - snap install microk8s --classic\n  - snap enable microk8s\n  - snap start microk8s \n  - snap install helm --classic\n  - usermod -a -G microk8s ${os_user}\n  - echo alias \\\"kubectl=microk8s kubectl\\\" \u003e\u003e /home/${os_user}/.profile\n  - mkdir -p /home/${os_user}/.kube\n  - mkdir -p /root/.kube\n  - microk8s config \u003e /home/${os_user}/.kube/config\n  - chmod 600 /home/${os_user}/.kube/config\n  - microk8s config \u003e /root/.kube/config\n  - chmod 600 /root/.kube/config\n  - chown -R ${os_user}:${os_user} /home/${os_user}/\n  - wait 120\n  - microk8s enable rbac dns ingress openebs\n  - microk8s kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.3.1/cert-manager.yaml\n  - helm repo add grafana https://grafana.github.io/helm-charts\n  - helm repo update\n  #- helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false\n  - helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false,loki.persistence.enabled=true,loki.persistence.storageClassName=openebs-hostpath,loki.persistence.size=5Gi\n\n\n\n\n\npower_state:\n  mode: reboot\n  delay: 300\n  condition: microk8s status\n\n\n",
            "vars": {
              "dev_ssh_id": "gh:mihaics",
              "os_user": "sysop",
              "root_ssh_key": "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq6cUeVqUAZ7ln2qFxLwpYcM8u1J20upM6VGmv4HxNTi9yl1sOfGr/9fodVVBFquk25bhiUzBAA41GuKVpXzroZU4QBp6roUqvJVavwtG6VNZB+F8SEa4puLJ4cf3gqgTiuyIeSx5S19weke0ktoj6o+b1L84Eoa9pBh1LuWdO4f0jbRy4deFpm8VIVRGjLG58NKVTrNvGKThZG+O3qPtoetlRS1Z3JXVVea0nFBdPZxj9F03YGeGKOC8YDL6XXbuO+lKXWEyUxt6kW6Hlb2XQwrkkABmIUHq4r8pnmZilfpuTB8B4Vtwj4ZX+5y6DoE9oLVXOLW/AP1As/DKC8ixZQ== mihai@i5737z.sysop-consulting.ro"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "meta_data",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "7032f941e9a16e7276fcfef58d26d3550b9c49b3da06e584fe6bbede2679fc20",
            "rendered": "local-hostname: loki-grafana\n",
            "template": "local-hostname: ${hostname}\n",
            "vars": {
              "hostname": "loki-grafana"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "network_config",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "470709d170e794f1687e6b3836b5d08ca64d7352c7a90793471038a4715f9027",
            "rendered": "version: 2\nethernets:\n  ens3:\n    dhcp4: true\n\n\n",
            "template": "version: 2\nethernets:\n  ens3:\n    dhcp4: true\n\n\n",
            "vars": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "libvirt_cloudinit_disk",
      "name": "commoninit",
      "provider": "provider[\"registry.terraform.io/dmacvicar/libvirt\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/var/lib/libvirt/images/loki-grafana-commoninit.iso;aef80203-b3f8-4b1c-bbaa-6654b457d074",
            "meta_data": "local-hostname: loki-grafana\n",
            "name": "loki-grafana-commoninit.iso",
            "network_config": "version: 2\nethernets:\n  ens3:\n    dhcp4: true\n\n\n",
            "pool": "default",
            "user_data": "#cloud-config\n# vim: syntax=yaml\n#\n\ngroups:\n    - sysop: [root,sys]\n\n\nusers:\n    - default\n    # User explicitly omitted from sudo permission; also default behavior. \n    - name: sysop\n      gecos: system operator\n      primary_group: sysop\n      groups: users, admin, docker\n      sudo: ALL=(ALL) NOPASSWD:ALL\n      homedir: /home/sysop\n      inactive: false\n      lock_passwd: true\n      shell: /bin/bash\n      system: true\n      uid: 1000\n      ssh_authorized_keys:\n        - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq6cUeVqUAZ7ln2qFxLwpYcM8u1J20upM6VGmv4HxNTi9yl1sOfGr/9fodVVBFquk25bhiUzBAA41GuKVpXzroZU4QBp6roUqvJVavwtG6VNZB+F8SEa4puLJ4cf3gqgTiuyIeSx5S19weke0ktoj6o+b1L84Eoa9pBh1LuWdO4f0jbRy4deFpm8VIVRGjLG58NKVTrNvGKThZG+O3qPtoetlRS1Z3JXVVea0nFBdPZxj9F03YGeGKOC8YDL6XXbuO+lKXWEyUxt6kW6Hlb2XQwrkkABmIUHq4r8pnmZilfpuTB8B4Vtwj4ZX+5y6DoE9oLVXOLW/AP1As/DKC8ixZQ== mihai@i5737z.sysop-consulting.ro\n      ssh_import_id: \n        - gh:mihaics\n        \n\ntimezone: UTC\n\nssh_import_id: \n    - gh:mihaics\n    \n\nntp:\n  enabled: true\n  ntp_client: chrony  # Uses cloud-init default chrony configuration\n\n\napt:\n  sources:\n    hashicorp:\n      source: \"deb [arch=amd64] https://apt.releases.hashicorp.com groovy main\"\n      key: |\n          -----BEGIN PGP PUBLIC KEY BLOCK-----\n\n          mQINBF60TuYBEADLS1MP7XrMlRkn1Y54cb2UclUMH8HkIRfBrhk5Leo9kNZc/2QD\n          LmdQbi3UbZkz0uVkHqbFDgV5lAnukCnxgr9BqnL0GJpO78le7gCCbM5bR4rTJ6Ar\n          OOtIKf25smGTIpbSwNdj8BOLqiExGFj/9L5X9S5kfq3vtuYt+lmxKkIrEPjSYnFR\n          TQ2mTL8RM932GJod/5VJ2+6YvrCjtPu5/rW02H1U2ZHiTtX6ZGnIvv/sprKyFRqT\n          x4Ib+o9XwXof/LuxTMpVwIHSzCYanH5hPc7yRGKzIntBS+dDom+h9smx7FTgpHwt\n          QRFGLtVoHXqON6nXTLFDkEzxr+fXq/bgB1Kc1TuzvoK601ztQGhhDaEPloKqNWM8\n          Ho7JU1RpnoWr5jOFTYiPM9uyCtFNsJmD9mt4K8sQQN7T2inR5Us0o510FqePRFeX\n          wOJUMi1CbeYqVHfKQ5cWYujcK8pv3l1a6dSBmFfcdxtwIoA16JzCrgsCeumTDvKu\n          hOiTctb28srL/9WwlijUzZy6R2BGBbhP937f2NbMS/rpby7M1WizKeo2tkKVyK+w\n          SUWSw6EtFJi7kRSkH7rvy/ysU9I2ma88TyvyOgIz1NRRXYsW7+brgwXnuJraOLaB\n          5aiuhlngKpTPvP9CFib7AW2QOXustMZ7pOUREmxgS4kqxo74CuFws163TwARAQAB\n          tFFIYXNoaUNvcnAgU2VjdXJpdHkgKEhhc2hpQ29ycCBQYWNrYWdlIFNpZ25pbmcp\n          IDxzZWN1cml0eStwYWNrYWdpbmdAaGFzaGljb3JwLmNvbT6JAk4EEwEIADgWIQTo\n          oDLglNjrTqGJ0nDaQYyIoyGfewUCXrRO5gIbAwULCQgHAgYVCgkICwIEFgIDAQIe\n          AQIXgAAKCRDaQYyIoyGfe6/WD/9dTM/1OSgbvSPpPJOOcn5L1nOKRBJpztr4V0ky\n          GoCDakIQ/sykbcuHXP79FGLzrM8zQOsbvVp/Z2lsWBnxkT8KWM+8LZxYToRGdZhr\n          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\n          =emKC\n          -----END PGP PUBLIC KEY BLOCK-----\n\npackage_upgrade: true\npackages:\n  - bash-completion\n  - consul\n  - htop\n  - iptables-persistent\n  - jq \n  - mc\n  - qemu-guest-agent\n  - runc\n  - vault\n  - vim\n  - wget\n  - zip \n  - snapd\n\n\n\nruncmd: # commands to run\n  - export ip_addr=$(ip route get 8.8.8.8 | awk -F\"src \" 'NR==1{split($2,a,\" \");print a[1]}')\n  - echo net.ipv6.conf.all.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.default.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - echo net.ipv6.conf.lo.disable_ipv6 = 1 \u003e\u003e /etc/sysctl.conf\n  - sysctl -p\n  - systemctl enable iscsid\n  - snap install microk8s --classic\n  - snap enable microk8s\n  - snap start microk8s \n  - snap install helm --classic\n  - usermod -a -G microk8s sysop\n  - echo alias \\\"kubectl=microk8s kubectl\\\" \u003e\u003e /home/sysop/.profile\n  - mkdir -p /home/sysop/.kube\n  - mkdir -p /root/.kube\n  - microk8s config \u003e /home/sysop/.kube/config\n  - chmod 600 /home/sysop/.kube/config\n  - microk8s config \u003e /root/.kube/config\n  - chmod 600 /root/.kube/config\n  - chown -R sysop:sysop /home/sysop/\n  - wait 120\n  - microk8s enable rbac dns ingress openebs\n  - microk8s kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.3.1/cert-manager.yaml\n  - helm repo add grafana https://grafana.github.io/helm-charts\n  - helm repo update\n  #- helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false\n  - helm --kubeconfig /root/.kube/config upgrade --install loki grafana/loki-stack  --set grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false,loki.persistence.enabled=true,loki.persistence.storageClassName=openebs-hostpath,loki.persistence.size=5Gi\n\n\n\n\n\npower_state:\n  mode: reboot\n  delay: 300\n  condition: microk8s status\n\n\n"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.template_file.cloud_init",
            "data.template_file.meta_data",
            "data.template_file.network_config"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "libvirt_domain",
      "name": "vm-domain",
      "provider": "provider[\"registry.terraform.io/dmacvicar/libvirt\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arch": "x86_64",
            "autostart": true,
            "boot_device": [],
            "cloudinit": "/var/lib/libvirt/images/loki-grafana-commoninit.iso;aef80203-b3f8-4b1c-bbaa-6654b457d074",
            "cmdline": null,
            "console": [
              {
                "source_host": "127.0.0.1",
                "source_path": "",
                "source_service": "0",
                "target_port": "0",
                "target_type": "serial",
                "type": "pty"
              },
              {
                "source_host": "127.0.0.1",
                "source_path": "",
                "source_service": "0",
                "target_port": "1",
                "target_type": "virtio",
                "type": "pty"
              }
            ],
            "coreos_ignition": null,
            "cpu": [],
            "description": "",
            "disk": [
              {
                "block_device": "",
                "file": "",
                "scsi": false,
                "url": "",
                "volume_id": "/var/lib/libvirt/images/loki-grafana-baseimage.qcow2",
                "wwn": ""
              }
            ],
            "emulator": "/usr/bin/qemu-system-x86_64",
            "filesystem": [],
            "firmware": "",
            "fw_cfg_name": "opt/com.coreos/config",
            "graphics": [
              {
                "autoport": true,
                "listen_address": "127.0.0.1",
                "listen_type": "address",
                "type": "spice",
                "websocket": 0
              }
            ],
            "id": "8ab6507c-e98a-4f60-b4db-bb59e0ee5892",
            "initrd": "",
            "kernel": "",
            "machine": "ubuntu",
            "memory": 12288,
            "metadata": null,
            "name": "loki-grafana",
            "network_interface": [
              {
                "addresses": [],
                "bridge": "",
                "hostname": "loki-grafana",
                "mac": "52:54:00:7E:25:18",
                "macvtap": "",
                "network_id": "f7601ad4-e56c-483d-be75-0552bf0673bd",
                "network_name": "default",
                "passthrough": "",
                "vepa": "",
                "wait_for_lease": false
              }
            ],
            "nvram": [],
            "qemu_agent": true,
            "running": true,
            "timeouts": null,
            "tpm": [],
            "vcpu": 6,
            "video": [],
            "xml": []
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "data.template_file.cloud_init",
            "data.template_file.meta_data",
            "data.template_file.network_config",
            "libvirt_cloudinit_disk.commoninit",
            "libvirt_volume.baseimage"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "libvirt_volume",
      "name": "baseimage",
      "provider": "provider[\"registry.terraform.io/dmacvicar/libvirt\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "base_volume_id": null,
            "base_volume_name": null,
            "base_volume_pool": null,
            "format": "qcow2",
            "id": "/var/lib/libvirt/images/loki-grafana-baseimage.qcow2",
            "name": "loki-grafana-baseimage.qcow2",
            "pool": "default",
            "size": 42949672960,
            "source": "/home/mihai/images/hirsute-server-cloudimg-amd64.img",
            "xml": []
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    }
  ]
}
